<template>
  <div :am-view="view" :am-mode="mode" class="route-view pr full bg-back" :view-full="full ? 1 : 0" @animationend="anim">
    <div class="full" am-view-item="list">
      <slot name="list" :mode="mode"></slot>
    </div>
    <div class="full" am-view-item="item">
      <slot name="item" :mode="mode"></slot>
    </div>
  </div>
</template>
<script setup lang="ts">
  import { ref, watch } from 'vue';
  import { useRoute } from 'vue-router';

  interface Props {
    full?: boolean | 0 | 1;
    once?: number;
    mode?: 'default' | 'preview' | 'window';
  }
  const props: any = withDefaults(defineProps<Props>(), {
    full: 0,
    once: 0,
    mode: 'default'
  });

  const route = useRoute();
  const init = ref(0);
  const view = ref('');
  const anim = (e: any) => {
    if (e.animationName === 'am-hide') {
      view.value = route.query.id ? 'item' : 'list';
    }
  };

  const a = () => {
    if (init.value) {
      if (!props.once) {
        view.value = route.query.id ? 'iteming' : 'listing';
      }
    } else {
      view.value = route.query.id ? 'item' : 'list';
      init.value = 1;
    }
  };

  watch(() => route.query.id, a);
  a();
</script>

<style lang="scss">
  // 默认模式
  [am-view] {
    overflow: hidden;

    @keyframes am-show {
      0% {
        opacity: 0;
        transform: translate3d(2em, 0, 0);
      }
      100% {
        opacity: 1;
        transform: translate3d(0, 0, 0);
      }
    }
    @keyframes am-hide {
      0% {
        opacity: 1;
        transform: translate3d(0, 0, 0);
      }
      100% {
        opacity: 0;
        transform: translate3d(2em, 0, 0);
      }
    }

    &[view-full~='1'] {
      position: fixed;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      z-index: 15;
    }

    [am-view-item] {
      display: none;

      &[am-view-item~='row'] {
        flex-direction: row !important;
      }
    }
    &[am-view='list'] {
      [am-view-item~='list'] {
        flex-direction: column;
        display: flex;
        animation: am-show 0.35s ease both;
      }
    }
    &[am-view='listing'] {
      [am-view-item~='item'] {
        flex-direction: column;
        display: flex;
        animation: am-hide 0.3s ease-in-out both;
      }
    }
    &[am-view='item'] {
      [am-view-item~='item'] {
        display: flex;
        animation: am-show 0.35s ease both;
      }
    }
    &[am-view='iteming'] {
      [am-view-item~='list'] {
        display: flex;
        animation: am-hide 0.3s ease-in-out both;
      }
    }
  }
</style>
